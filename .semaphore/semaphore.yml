version: v1.0
name: test
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: build
    task:
      env_vars:
        - name: DISCOURSE_HOSTNAME
          value: www.example.com
        - name: RUBY_GLOBAL_METHOD_CACHE_SIZE
          value: "131072"
        #BUILD_TYPE: ${{ matrix.build_types }}
        #TARGET: ${{ matrix.target }}
        - name: RAILS_ENV
          value: test
        - name: PGHOST
          value: localhost
        - name: PGUSER
          value: discourse
        - name: PGPASSWORD
          value: discourse
      jobs:
        - name: build&test
          commands:
            - checkout
          matrix:
            - env_var: build_types
              values: [ "BACKEND", "FRONTEND", "LINT" ]
            - env_var: target
              values: [ "PLUGINS", "CORE" ]    