version: v1.0
name: 
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: build
    task:
      env:
        DISCOURSE_HOSTNAME: www.example.com
        RUBY_GLOBAL_METHOD_CACHE_SIZE: 131072
        #BUILD_TYPE: ${{ matrix.build_types }}
        #TARGET: ${{ matrix.target }}
        RAILS_ENV: test
        PGHOST: localhost
        PGUSER: discourse
        PGPASSWORD: discourse
      jobs:
        - name: build&test
          commands:
            - checkout
          matrix:
            - env_var: build_types
              values: [ "BACKEND", "FRONTEND", "LINT" ]
            - env_var: target
              values: [ "PLUGINS", "CORE" ]    